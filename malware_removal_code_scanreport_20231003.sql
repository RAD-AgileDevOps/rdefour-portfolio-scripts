/*

	Data Engineer: Roger De Four
	Date: 2023-10-03
	Description: I received an updated scanreport from Hostgator , and it hs become apparrent that I need to standardiae
							the SQL script that I wrote previously to generate the LINUX removal and backup code
 */
--DROP TABLE tbl_malware_removal_code_output.tbl_malware_removal_code_output ; 
CREATE TABLE IF NOT EXISTS  scanreport_20231003.tbl_malware_removal_code_output

AS
SELECT 


	-- orig_20230926_b4_parsing.*
	scr.logid ,
	scr.col1 ,
	
	-- concat('rm -rfv ' ,'  ' ,orig_20230926_b4_parsing.column1_original) as "Linux_removal_code" ,
	
	-- RIGHT( orig_20230926_b4_parsing.column1_original, 3),
	concat('rm -rvf ' ,'  ' ,LEFT(scr.col1, (LENGTH(scr.col1))))  as "Linux_removal_code" ,
	
	--concat('zip ' ,'  ' ,LEFT(orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1)))  as "Linux_removal_code"
	-- --LEFT((orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1)), (Position('/.htacce' in LEFT(orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1))))) 
	
	-- --Position('/.htacce' in LEFT(orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1)))  AS  "choice1" ,
	-- --Position('/upl.php' in LEFT(orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1)))  AS  "choice2" ,
	
	CASE 
	
		-- -- .htaccess
	   WHEN (RIGHT(scr.col1 , 9) = '.htaccess')  then concat('zip ', (LEFT( scr.col1,(Position('/.htacce' in LEFT(scr.col1, (LENGTH(scr.col1))))) )), '.zip ' ,'  ' , (LEFT( scr.col1 ,(Position('/.htacce' in LEFT(scr.col1, (LENGTH(scr.col1) )))) )))
	   -- --upl.php
	   --WHEN (RIGHT(scr.col1, 8) = 'upl.php:')  then (LEFT( scr.col1,(Position('/upl.php' in LEFT(orig_20230926_b4_parsing.column1_original, (LENGTH(orig_20230926_b4_parsing.column1_original) -1)))) ))
	   WHEN (RIGHT(scr.col1, 7) = 'upl.php')  then concat('zip ', (LEFT( scr.col1,(Position('/upl.php' in LEFT(scr.col1, (LENGTH(scr.col1))))) )), '.zip ' ,'  ' , (LEFT( scr.col1,(Position('/upl.php' in LEFT(scr.col1, (LENGTH(scr.col1))))) ))         )
	   
	   WHEN (RIGHT(scr.col1, 8) = 'task.php')  then concat('zip ', (LEFT( scr.col1,(Position('/task.php' in LEFT(scr.col1, (LENGTH(scr.col1))))) )), '.zip ' ,'  ' , (LEFT( scr.col1,(Position('/task.php' in LEFT(scr.col1, (LENGTH(scr.col1) )))) ))         )
	END as Outcome   
	
   FROM  scanreport_20231003.tbl_scanreport20231003_1811 as scr
     

	 
	 ;